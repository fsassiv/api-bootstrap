FROM node:20-bullseye-slim AS builder

WORKDIR /usr/src/app

# Update system packages to pick up security fixes
RUN apt-get update && \
	apt-get upgrade -y && \
	rm -rf /var/lib/apt/lists/*

COPY package*.json ./

# Use npm ci for reproducible, faster and safer installs
RUN npm ci --prefer-offline --no-audit --no-fund

COPY . .

CMD ["npm", "run", "start:dev", "api-gateway"]
